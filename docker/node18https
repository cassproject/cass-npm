FROM node:18
WORKDIR code
COPY package.json package.json
RUN npm install

COPY ca.crt ca.crt
COPY client.crt client.crt
COPY client.key client.key
COPY index.js index.js
COPY src src


COPY test.js test.js
COPY ca.crt ca.crt
COPY client.crt client.crt
COPY client.key client.key
ENV CASS_LOOPBACK=https://docker.host.internal/api/
RUN sed -i '1crequire("cassproject");' test.js
ENTRYPOINT npm run mocha:clientSideCertificates